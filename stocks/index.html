<html>

<head>
  <!--OPTIONAL Design Time and themes-->

  <link rel="stylesheet" href="assets/cover.css" />
  <link rel="stylesheet" href="assets/toc.css" />
  <link rel="stylesheet" href="assets/header-footer.css" />
  <link rel="stylesheet" href="assets/main.css" />
  <script src="https://unpkg.com/numbro@2.1.2/dist/numbro.min.js"></script>
  <script src="https://unpkg.com/chart.js@2.7.3/dist/Chart.min.js"></script>
  <script src="https://unpkg.com/chartjs-plugin-datalabels@0.6.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <script src="https://unpkg.com/handlebars@latest/dist/handlebars.min.js"></script>

  <!--OPTIONAL Handlebars loader-->


  <!-- OR INCLUDE THIS SCRIPT
<script src="https://unpkg.com/handlebars@latest/dist/handlebars.min.js"></script>

-->

</head>


<body>

  {{#each companies}}
  <header class="header">
    <section class="header-content">
      <section class="header-company">
        <h1 class="header-title">{{company.fullName}} ({{company.abbreviation}})</h1>
        <h2 class="header-subtitle">{{company.business}}</h2>
      </section>
      <section class="header-legend">
        <h1 class="header-title">Detailed Stock Report</h1>
        <h2 class="header-subtitle">Report Date: {{formatReportDate}}</h2>
      </section>
    </section>
  </header>
  <section id="{{peerName}}">
    <section class="summary-score">
      <section class="summary-score-row">
        <div>
          <div>
            <div class="summary-score-label">Last Close</div>
            <div class="summary-score-top-label">
              <span class="summary-score-value">{{lastClose}}</span>&nbsp;<span
                class="summary-score-currency">({{currency}})</span>
            </div>
          </div>
          <div class="summary-score-separator">
            <!--TODO formatReportDate ../exchangeDate -->
            <div class="summary-score-text">{{exchangeDate}}</div>
            <div class="summary-score-top-label">
              <span class="summary-score-text">{{stockExchange}} Exchange</span>
            </div>
          </div>
        </div>
        <div>
          <table class="summary-score-table">
            <tr>
              <td class="summary-score-label">Avg Daily Vol</td>
              <td class="summary-score-label">52-Week High</td>
              <td class="summary-score-label">Trailing PE</td>
              <td class="summary-score-label">Annual Div</td>
              <td class="summary-score-label cell-space">ROE</td>
              <td class="summary-score-label">LTG Forecast</td>
              <td class="summary-score-label">1-Mo Return</td>
            </tr>
            <tr>
              <td class="summary-score-value" data-number-format>{{avgDailyVol}}</td>
              <td class="summary-score-value" data-number-format>{{52WeekHigh}}</td>
              <td class="summary-score-value" data-number-format>{{trailingPE}}</td>
              <td class="summary-score-value" data-number-format>{{annualDiv}}</td>
              <td class="summary-score-value" data-percentage-format>{{roePercentage}}</td>
              <td class="summary-score-value" data-percentage-format>{{ltgForecastPercentage}}</td>
              <td class="summary-score-value" data-percentage-format>{{1MoReturnPercentage}}</td>
            </tr>
            <tr class="summary-score-table-top-space">
              <td class="summary-score-label">Market Cap</td>
              <td class="summary-score-label">52-Week Low</td>
              <td class="summary-score-label">Forward PE</td>
              <td class="summary-score-label">Dividend Yield</td>
              <td class="summary-score-label cell-space">Annual Rev</td>
              <td class="summary-score-label">Inst Own</td>
              <td class="summary-score-label">3-Mo Return</td>
            </tr>
            <tr>
              <td class="summary-score-value" data-average-format>{{marketCap}}</td>
              <td class="summary-score-value" data-number-format>{{52WeekLow}}</td>
              <td class="summary-score-value" data-number-format>{{forwardPE}}</td>
              <td class="summary-score-value" data-percentage-format>{{dividendYieldPercentage}}</td>
              <td class="summary-score-value" data-average-format>{{annualRev}}</td>
              <td class="summary-score-value" data-percentage-format>{{instOwnPercentage}}</td>
              <td class="summary-score-value" data-percentage-format>{{3MoReturn}}</td>
            </tr>
          </table>
        </div>
      </section>
    </section>
  </section>


  {{/each}}
  <footer class="footer">
    <section class="footer-content">
      <section class="footer-legend">
        <div class="footer-page-numbers">Page x of XXX
        </div>
        <div class="footer-copy">Â© 209999 jsreport. All rights reserved.</div>
      </section>
      <section class="footer-logo">
        <img src="images/logo.png" />
      </section>
    </section>
  </footer>

</body>
<script>
  async function main() {



    //TODO wait for on ready and set RESPONSIVEPAPER Ready
    let response = await fetch("assets/data.json");
    response = await response.json();

    Chart.plugins.unregister(ChartDataLabels)



    var source = document.body.innerHTML;
    var template = Handlebars.compile(source);
    var html = template(response);
    document.body.innerHTML = html;

    const numberEls = document.querySelectorAll('[data-number-format]')
    const percentageEls = document.querySelectorAll('[data-percentage-format]')
    const averageEls = document.querySelectorAll('[data-average-format]')
    const averageScoreTrendChartEls = document.querySelectorAll('[data-average-score-trend-chart]')
    const scorePeerTrendChartEls = document.querySelectorAll('.average-score-peer-trend-chart')
    const volumesChartEls = document.querySelectorAll('.scores-volume-chart')
    const pricesChartEls = document.querySelectorAll('.scores-price-chart')
    const averageScoreIndicatorChartEls = document.querySelectorAll('[data-average-score-indicator-chart]')


    numberEls.forEach((el) => {
      try {
        const mantissa = el.dataset.mantissa != null ? parseInt(el.dataset.mantissa, 10) : 2
        const trimMantissa = el.dataset.trimMantissa != null ? Boolean(parseInt(el.dataset.trimMantissa, 10)) : true

        el.innerText = numbro(el.innerText).format({
          thousandSeparated: true,
          trimMantissa,
          mantissa
        })
      } catch (err) {
        console.error(err)
      }
    })

    percentageEls.forEach((el) => {
      try {
        const mantissa = el.dataset.mantissa != null ? parseInt(el.dataset.mantissa, 10) : 2
        const trimMantissa = el.dataset.trimMantissa != null ? Boolean(parseInt(el.dataset.trimMantissa, 10)) : true

        el.innerText = numbro(el.innerText).format({
          output: 'percent',
          mantissa,
          trimMantissa
        })
      } catch (err) {
        console.error(err)
      }
    })
    averageEls.forEach((el) => {
      try {
        el.innerText = numbro(el.innerText).format({
          average: true,
          mantissa: 1
        }).toUpperCase()
      } catch (err) {
        console.error(err)
      }
    })
  }
  window.onload = function () {
    main()
  }
</script>

</html>